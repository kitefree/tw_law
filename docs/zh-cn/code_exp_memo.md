
# SQL

## `編章節`按鈕查詢

```sql
-- 有編章節的法規才會出現這個按鈕
SELECT AA003,AA004,AB005,AA001,AA002
,(SELECT AC004 FROM LAWAC WHERE AA001=AC001 AND AA002 = 'A0010053' AND AC003 = AB003 LIMIT 1) AS START_NUM
,(SELECT COUNT(AC001) FROM LAWAC WHERE AA001=AC001 AND AA002 = 'A0010053' AND AC003 = AB003) AS CNT
FROM LAWAA
LEFT JOIN LAWAB ON AA002=AB002 
WHERE AA002='A0010053'
ORDER BY AB003;
```

## `所有條文`按鈕查詢

要注意有兩種資料,SQL處理不同, 1:沒有編章節的法規, 2:有編章節的法規

### 1. 沒有編章節的法規

```sql
SET @pAA002='A0000002'; /* 中華民國憲法增修條文 */
SELECT '' AS AA003, '' AS AA004
,'' AS AB002,'' AS AB003
,'' AS AB005
,AC004
,AC007
,AC008        
FROM `LAWAC` WHERE AC002='{$AA002}
```

### 2. 有編章節的法規 (編、章、節、款、目)

```sql
-- SET @pAA002='B0000001';/* 民法 */
SELECT AA003,AA004
,AB002,AB003
,AB005
,AC004
,AC007
,AC008
-- ,CAST(SUBSTRING_INDEX(AC004,'-', 1) AS UNSIGNED)
-- ,CASE WHEN LOCATE('-',AC004) >0 THEN CAST(SUBSTRING_INDEX(AC004,'-', -1) AS UNSIGNED) ELSE 0 END 
FROM LAWAA 
LEFT JOIN LAWAB ON AA002 = AB002
LEFT JOIN LAWAC ON AA002 = AC002 AND AC003 = AB003
WHERE AA002='B0000001'
ORDER BY AB003
,CAST(SUBSTRING_INDEX(AC004,'-', 1) AS UNSIGNED) ASC
,CASE WHEN LOCATE('-',AC004) >0 THEN CAST(SUBSTRING_INDEX(AC004,'-', -1) AS UNSIGNED) ELSE 0 END ASC

```
